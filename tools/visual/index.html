<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="app.js"></script>
    <link rel="icon" type="image/jpeg" href="California_sea_lion_in_La_Jolla_(70568).jpg" />
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid black;
            padding: 4px;
        }

        .scroll-box {
            height: 200px; /* Set the height of the scrollable area */
            width: 300px; /* Set the width */
            overflow-y: scroll; /* Enable vertical scrolling */
            border: 1px solid #ccc; /* Optional: Add a border */
        }

    </style>
</head>

<body>

    <h1>GBA Emulator</h1>

    <h2>Registers</h2>
    <table id="registersTable"></table>
    <script>
    ReadRegisterData(3).then((registers) => {
        console.log("Decoded registers:", registers);

        const flat_registers = Object.entries(registers).map(
            ([key, value]) => `${key}: ${toHex(value)}`
        );

        const num_cols = 4;
        let table = [];
        for (let i = 0; i < flat_registers.length; i += num_cols) {
            table.push(flat_registers.slice(i, i + num_cols));
        }
        console.log("table", table);

        const table_element = document.getElementById("registersTable");
        for (let i = 0; i < table.length; ++i)
        {
            let tr = document.createElement("tr");
            for (let j = 0; j < table[i].length; j++) {
                const td = document.createElement("td");
                td.textContent = table[i][j];
                tr.appendChild(td);
            }
            table_element.appendChild(tr);
        }
    });
    </script>

    <h2>Memory</h2>

    <h3>
        BIOS 
        <input type="text" placeholder="Start address" id="biosStartAddrInput" />
        <input type="text" placeholder="End address" id="biosEndAddrInput" />
    </h3>
    <div class="scroll-box">
        <table id="memoryTable">
        </table>
    </div>
    <script>
        let memory;
        ReadMemoryData(3).then((memory_data) => {
            console.log("Read memory");
            memory = memory_data;
        });

        function update(){
            const flat_memory = memory.BIOS;
            const table_element = document.getElementById("memoryTable");
            table_element.innerHTML = "";

            const biosStartAddrInput = Math.max(parseInt(document.getElementById("biosStartAddrInput").value), 0);
            const biosEndAddrInput = Math.min(parseInt(document.getElementById("biosEndAddrInput").value), flat_memory.length - 1);
            for (let i = biosEndAddrInput; i >= biosStartAddrInput; --i)
            {
                let tr = document.createElement("tr");

                const td1 = document.createElement("td");
                td1.textContent = toHex(i);
                const td2 = document.createElement("td");
                td2.textContent = toHex(flat_memory[i]);
                tr.appendChild(td1);
                tr.appendChild(td2);

                table_element.appendChild(tr);
            }
        }
        document.getElementById("biosStartAddrInput").addEventListener("input", function (event) {
            update();
        });
        document.getElementById("biosEndAddrInput").addEventListener("input", function (event) {
            update();
        });
    </script>


    <h2>BitUtils</h2>

    <div>
        <input type="text" placeholder="Hex" id="hexInput" />
        <div>
            <table id="binOutputTable">
            </table>
        </div>
    </div>
    <script>
        document.getElementById("hexInput").addEventListener("input", function (event) {
            let bin_output_table = document.getElementById("binOutputTable");
            bin_output_table.innerHTML = "";
            bin_string = toBinary(parseInt(event.target.value)).slice(2);
            let tr = document.createElement("tr");
            let trh = document.createElement("tr");
            for (let i = 0; i < bin_string.length; ++i)
            {
                const td = document.createElement("td");
                const tdh = document.createElement("td");
                td.textContent = bin_string[i];
                tdh.textContent = bin_string.length - i - 1;

                td.style.width = "20px";
                td.style.textAlign = "center";

                tdh.style.width = "20px";
                tdh.style.textAlign = "center";

                const lightColors = [
                "#FFB3BA", // Light Red/Pink
                "#FFDFBA", // Light Orange
                "#FFFFBA", // Light Yellow
                "#BAFFC9", // Light Green
                "#BAE1FF", // Light Blue
                "#D6BAFF", // Light Purple
                "#FFE1BA", // Light Peach
                "#BAFFF9"  // Light Cyan
                ];

                td.style.backgroundColor = lightColors[Math.floor(i/4)];
                tdh.style.backgroundColor = lightColors[Math.floor(i/4)];

                tr.appendChild(td);
                trh.appendChild(tdh)
            }
            bin_output_table.appendChild(trh);
            bin_output_table.appendChild(tr);
        });
    </script>
    
</body>

</html>